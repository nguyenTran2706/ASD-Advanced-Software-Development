<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Find Agent</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/css/style.css" />
</head>

<body>
  <!-- NAVBAR -->
  <header class="nav-shell">
    <div class="nav-top">
      <button id="menuToggle" class="menu-btn" aria-expanded="false" aria-controls="navLinks">
        <span class="menu-icon"></span>
        <span class="menu-text">Menu</span>
      </button>

      <a href="index.html" class="brand">
        <img src="/Assets/Logo.png" alt="logo" style="height:40px" />
      </a>

      <div class="navbar-buttons" id="navbarUser">
        <a class="button-primary" href="signUp.html" style="text-decoration:none;color:#fff">Sign Up</a>
        <a class="button-primary" href="login.html" style="text-decoration:none;color:#fff">Login</a>
      </div>
    </div>

    <div id="navLinks" class="nav-links">
      <nav id="navbar" class="navbar-selector">
        <a href="index.html">Home</a>
        <a href="buy.html">Buy</a>
        <a href="rent.html">Rent</a>
        <a href="sold.html">Sold</a>
        <a href="findAgent.html" class="nav-active">Find Agent</a>
        <a href="news.html">News</a>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="agent-hero">
    <div class="agent-hero-inner">
      <div class="agent-hero-left">
        <h1 class="agent-title">Search and compare real estate agents</h1>
        <p class="agent-subtitle">
          Whether you're starting your search or already have someone in mind,
          compare sales agents, property managers, or agencies before deciding.
        </p>
        
        <div class="agent-search">
          <div class="search-input-wrap">
            <svg class="search-icon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M10 18a8 8 0 1 1 5.293-14.003A8 8 0 0 1 10 18Zm11 3-6.001-6"
                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
            <input id="agentSearch" class="agent-search-input" placeholder="Search by region, suburb or postcode"
              autocomplete="off" />
          </div>
          <ul id="agentSuggest" class="agent-suggest"></ul>
          <button id="agentSearchBtn" class="agent-search-btn">Search</button>
        </div>

        <div class="agent-hero-right">
          <img src="/Assets/housekey.avif" class="agent-hero-img" alt="Agents meeting" />
        </div>
    </div>
  </section>

  <section class="agent-steps">
    <h2 class="steps-title">Selling your place?</h2>
    <p class="steps-subtitle">Compare real estate agents before you‚Äôre sold on one.</p>

    <div class="steps-grid">
      <div class="step-card">
        <div class="step-badge">1</div>
        <h3>Search for an agent</h3>
        <p>Enter your suburb to find agents specialised in your area.</p>
      </div>

      <div class="step-card">
        <div class="step-badge">2</div>
        <h3>Compare their stats</h3>
        <p>Compare agent stats and their reviews to see who might be right for you.</p>
      </div>

      <div class="step-card">
        <div class="step-badge">3</div>
        <h3>Connect with the best</h3>
        <p>Get a free market appraisal from agents before making your decision.</p>
      </div>
    </div>
  </section>

  <!-- FILTERS -->
  <section class="agent-results-wrap">
    <div class="results-header">
      <div class="results-path" id="resultsPath">Real Estate Agents</div>
      <div class="filters-row">
        <button id="agentBtn" class="chip active">Agent</button>
        <button id="agencyBtn" class="chip">Agency</button>

        <div class="chip dropdown-chip">
          <select id="sortSel">
            <option value="">Suburb sales & performance</option>
            <option value="sales">Most Properties Sold</option>
            <option value="price">Highest Median Price</option>
            <option value="days">Fastest Sale (Fewest Days)</option>
          </select>
        </div>

        <div class="chip dropdown-chip">
          <select id="reviewSel">
            <option value="">Reviews (12 months)</option>
            <option value="10">‚â• 10</option>
            <option value="50">‚â• 50</option>
            <option value="100">‚â• 100</option>
          </select>
        </div>

        <div class="chip dropdown-chip">
          <select id="typeSel">
            <option value="">All Property Types</option>
            <option value="professional">Professional</option>
            <option value="communicator">Great Communicator</option>
            <option value="local">Local Expert</option>
          </select>
        </div>
      </div>
    </div>

    <div id="agentList" class="agent-list"></div>
  </section>

  <div style="height:60px"></div>

  <!-- SCRIPT -->
  <script>
  (() => {
  /* -------- NAVBAR LOGIN/LOGOUT (kept) -------- */
  (function () {
    const navbarUser = document.getElementById("navbarUser");
    try {
      const user = JSON.parse(localStorage.getItem("user") || "null");
      if (!user) return;
      const displayName = user.first_name?.trim() || user.email;
      navbarUser.innerHTML = `
        <span style="margin-right:10px; color:#047857; font-weight:600;">Welcome, ${displayName}</span>
        <button class="button-secondary" id="logoutBtn">Logout</button>`;
      document.getElementById("logoutBtn").addEventListener("click", () => {
        localStorage.removeItem("user"); window.location.reload();
      });
    } catch (_) {}
  })();

  (async function () {
        try {
          const res = await fetch("index.html");
          const html = await res.text();
          const doc = new DOMParser().parseFromString(html, "text/html");
          const navShell = doc.querySelector(".nav-shell");
          // Find the nav bar's inline script in index.html
          const navScriptText = Array.from(doc.querySelectorAll('script:not([src])'))
                                     .find(s => s.innerText.includes('// -------- Auth area'))
                                     ?.innerText;
          
          document.querySelector(".nav-shell").replaceWith(navShell);
          if (navScriptText) {
            eval(navScriptText); // Re-run the auth/nav script
          }
        } catch(e) {
          console.error("Could not load navigation bar.", e);
        }
      })();

  /* -------- MENU TOGGLE + ACTIVE NAV (kept) -------- */
  (function () {
    const shell = document.querySelector(".nav-shell");
    const btn = document.getElementById("menuToggle");
    if (btn && shell) {
      btn.addEventListener("click", () => {
        const isOpen = shell.classList.toggle("open");
        btn.setAttribute("aria-expanded", String(isOpen));
      });
    }
    const path = location.pathname.replace(/\/+$/, "");
    document.querySelectorAll("#navbar a[href]").forEach((a) => {
      const href = a.getAttribute("href") || "";
      const isHome =
        (path === "" || path === "/") &&
        (href === "index.html" || href === "/index.html");
      if (isHome || path.endsWith(href) || (href.startsWith("/") && path === href)) {
        a.classList.add("nav-active");
      }
    });
  })();

  /* ======================================================
     AUTOCOMPLETE (restored old-style SUBURBS suggestion)
     ====================================================== */

  const input = document.getElementById("agentSearch");
  const suggest = document.getElementById("agentSuggest");
  const searchBtn = document.getElementById("agentSearchBtn");

  // CHANGED: Using fallback static SUBURBS (like old version)
  const SUBURBS = [
    { name: "Canterbury, NSW", postcode: "2193" },
    { name: "Ashbury, NSW", postcode: "2193" },
    { name: "Hurlstone Park, NSW", postcode: "2193" },
    { name: "Newtown, NSW", postcode: "2042" },
    { name: "Marrickville, NSW", postcode: "2204" },
    { name: "Zetland, NSW", postcode: "2017" },
  ];

  function showSuggestions(val) {
    const v = (val || "").trim().toLowerCase();
    if (!v) {
      suggest.innerHTML = "";
      suggest.classList.remove("open");
      return;
    }
    const hits = SUBURBS.filter(
      s => s.name.toLowerCase().includes(v) || s.postcode.includes(v)
    ).slice(0, 5);

    suggest.innerHTML = hits.map(h => `
      <li class="suggest-item" data-name="${h.name} ${h.postcode}">
        <span class="suggest-icon">üìç</span>
        <span>${h.name} <strong>${h.postcode}</strong></span>
      </li>`).join("");
    suggest.classList.toggle("open", hits.length > 0);
  }

  input.addEventListener("input", (e) => showSuggestions(e.target.value));
  suggest.addEventListener("click", (e) => {
    const li = e.target.closest(".suggest-item");
    if (!li) return;
    input.value = li.dataset.name;
    suggest.classList.remove("open");
    doSearch();
  });
  document.addEventListener("click", (e) => {
    if (!e.target.closest(".agent-search")) suggest.classList.remove("open");
  });

  function doSearch() {
    const q = input.value.trim();
    const u = new URL(location.href);
    if (q) u.searchParams.set("q", q);
    else u.searchParams.delete("q");
    history.replaceState({}, "", u);
    renderFiltered();
  }
  searchBtn.addEventListener("click", doSearch);
  input.addEventListener("keydown", (e) => { if (e.key === "Enter") { e.preventDefault(); doSearch(); } });

  /* ===================== AGENTS DATA ===================== */
  const AGENTS = [
    { id: 1, name: "Adrian William", role: "Director", agency: "Adrian William", suburb: "Newtown, NSW 2042", stats: { sold_suburb: 20, median_price: "$1.07M", median_days: 23, sold_all: 38 }, reviews: { score: 5, count: 1093, last12: 324 }, tags: ["Professional", "Great Communicator", "Genuine"], headshot: "/Assets/broker2.png", photos: ["/Assets/berita2.png", "/Assets/berita3.png"], agencyVideo: "/Assets/news1.png" },
    { id: 2, name: "Manuel Roussakis", role: "Director", agency: "Ray White - Canterbury", suburb: "Canterbury, NSW 2193", stats: { sold_suburb: 18, median_price: "$803k", median_days: 27, sold_all: 37 }, reviews: { score: 5, count: 34, last12: 13 }, tags: ["Responsive", "Honest", "Local Expert"], headshot: "/Assets/broker3.png", photos: ["/Assets/berita3.png"], agencyVideo: "/Assets/news2.png" },
    { id: 3, name: "Denny Barros", role: "Licensed Agent", agency: "Adrian William", suburb: "Canterbury, NSW 2193", stats: { sold_suburb: 15, median_price: "$1.02M", median_days: 25, sold_all: 30 }, reviews: { score: 5, count: 48, last12: 17 }, tags: ["Knowledgeable", "Great Communicator"], headshot: "/Assets/broker4.png", photos: ["/Assets/berita4.png"], agencyVideo: "/Assets/news3.png" },
    { id: 4, name: "Sarah Kim", role: "Senior Agent", agency: "Ray White - Sydney", suburb: "Sydney, NSW 2000", stats: { sold_suburb: 30, median_price: "$1.25M", median_days: 21, sold_all: 50 }, reviews: { score: 5, count: 220, last12: 80 }, tags: ["Professional", "Local Expert"], headshot: "/Assets/broker1.png", photos: ["/Assets/berita1.png"], agencyVideo: "/Assets/news4.png" },
    { id: 5, name: "Michael Chen", role: "Director", agency: "LJ Hooker", suburb: "Chatswood, NSW 2067", stats: { sold_suburb: 25, median_price: "$1.48M", median_days: 22, sold_all: 45 }, reviews: { score: 5, count: 500, last12: 150 }, tags: ["Great Communicator", "Professional"], headshot: "/Assets/brooker11.png", photos: ["/Assets/berita2.png"], agencyVideo: "/Assets/news1.png" },
    { id: 6, name: "Emily Davis", role: "Property Specialist", agency: "Belle Property", suburb: "Bondi, NSW 2022", stats: { sold_suburb: 20, median_price: "$1.35M", median_days: 19, sold_all: 35 }, reviews: { score: 4.9, count: 90, last12: 40 }, tags: ["Local Expert", "Responsive"], headshot: "/Assets/broker8.png", photos: ["/Assets/berita3.png"], agencyVideo: "/Assets/news2.png" },
    { id: 7, name: "James Lee", role: "Sales Agent", agency: "Ray White - Chatswood", suburb: "Chatswood, NSW 2067", stats: { sold_suburb: 22, median_price: "$1.4M", median_days: 20, sold_all: 40 }, reviews: { score: 5, count: 180, last12: 60 }, tags: ["Professional", "Honest"], headshot: "/Assets/broker7.png", photos: ["/Assets/berita4.png"], agencyVideo: "/Assets/news3.png" },
    { id: 8, name: "Laura White", role: "Director", agency: "McGrath", suburb: "Zetland, NSW 2017", stats: { sold_suburb: 16, median_price: "$930k", median_days: 24, sold_all: 28 }, reviews: { score: 4.8, count: 75, last12: 25 }, tags: ["Knowledgeable", "Local Expert"], headshot: "/Assets/broker10.png", photos: ["/Assets/berita1.png"], agencyVideo: "/Assets/news4.png" },
    { id: 9, name: "Daniel Brown", role: "Agent", agency: "LJ Hooker", suburb: "Marrickville, NSW 2204", stats: { sold_suburb: 12, median_price: "$780k", median_days: 29, sold_all: 20 }, reviews: { score: 4.7, count: 60, last12: 18 }, tags: ["Friendly", "Great Communicator"], headshot: "/Assets/broker9.png", photos: ["/Assets/berita2.png"], agencyVideo: "/Assets/news1.png" },
    { id: 10, name: "Sophie Martin", role: "Agent", agency: "Belle Property", suburb: "Kingsford, NSW 2018", stats: { sold_suburb: 18, median_price: "$1.1M", median_days: 26, sold_all: 32 }, reviews: { score: 5, count: 120, last12: 55 }, tags: ["Responsive", "Professional"], headshot: "/Assets/broker5.png", photos: ["/Assets/berita3.png"], agencyVideo: "/Assets/news2.png" },
  ];

  /* =========================== RENDERING =========================== */
  const $ = (s) => document.querySelector(s);
  const listEl = $("#agentList");
  const pathEl = $("#resultsPath");
  let currentMode = "Agent";

  function cardTemplate(a) {
    const profileHref = `agentResults.html?id=${encodeURIComponent(a.id)}`;
  return `
    <div class="agent-card">
      <div class="agency-banner ${a.agency_slug === 'raywhite' ? 'agency-raywhite' : ''}">
        ${a.agency || ''}
      </div>

      <div class="agent-card-body">
        <!-- Left: avatar + identity (clickable to profile) -->
        <div class="agent-left">
          <a href="${profileHref}" data-profile-href="${profileHref}">
          <img
            class="agent-avatar"
            src="${a.headshot || a.photo || a.avatar || '/Assets/agents/default.jpg'}"
            alt="${a.name}">
          </a>
          <div class="agent-ident">
            <a href="${profileHref}" data-profile-href="${profileHref}"
               class="agent-name" style="text-decoration:none; color:inherit;">
              ${a.name}
            </a>
            <div class="agent-role">${a.role || ''}</div>
            <div class="agent-agency">${a.agency || ''}</div>
            <div class="agent-reviews">‚≠ê ${a.rating?.toFixed ? a.rating.toFixed(1) : (a.rating || '5.0')}
              <span class="agent-reviews-sub">(${a.reviews_count || 0} reviews)</span>
            </div>
          </div>
        </div>

        <!-- Middle: quick stats (keep your existing stats if different) -->
        <div class="agent-middle">
          <div class="stat">
            <div class="stat-label">Median sold price</div>
            <div class="stat-value">${a.stats?.median_price || '$1.07M'}</div>
          </div>
          <div class="stat">
            <div class="stat-label">Median days</div>
            <div class="stat-value">${a.stats?.median_days || 23}</div>
          </div>
          <div class="stat">
            <div class="stat-label">Sold (lead)</div>
            <div class="stat-value">${a.stats?.sold_suburb || a.stats?.lead_sold || 20}</div>
          </div>
        </div>

        <!-- Right: actions -->
        <div class="agent-right">
          <a class="btn-primary-full" href="${profileHref}" data-profile-href="${profileHref}">
            View profile
          </a>
          <button class="btn-ghost-full enquire-btn"
                  data-id="${a.id}"
                  data-name="${a.name}"
                  data-agency="${a.agency || ''}"
                  data-suburb="${a.suburb || ''}">
            Enquire
          </button>
          <a class="btn-ghost-full" href="tel:${(a.phone || '').replace(/\s+/g,'')}">Call</a>

          <!-- tags (optional) -->
          ${Array.isArray(a.tags) && a.tags.length
            ? `<div class="agent-tags">${a.tags.map(t => `<span class="tag">${t}</span>`).join('')}</div>`
            : ''}
        </div>
      </div>
    </div>
  `;
}

  function bindActions(list) {
  // Enquire buttons ‚Üí go to enquire.html with agent details in querystring
  document.querySelectorAll('.enquire-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const q = new URLSearchParams({
        agentId: btn.dataset.id,
        agent: btn.dataset.name,
        agency: btn.dataset.agency || '',
        suburb: btn.dataset.suburb || ''
      });
      location.href = `enquire.html?${q.toString()}`;
    });
  });

  document.getElementById('agentList')?.addEventListener('click', (e) => {
  const el = e.target.closest('[data-profile-href], a[href*="agentResults.html"]');
  if (el) {
    const href = el.dataset.profileHref || el.getAttribute('href');
    if (href) {
      window.location.href = href;  // go, even if something called preventDefault
    }
  }
});
}

  function renderAgents(list, label) {
    pathEl.textContent = label;
    listEl.innerHTML = list.map(cardTemplate).join("");
    bindActions(list);
  }

  function renderFiltered() {
    let list = [...AGENTS];

    const u = new URL(location.href);
    const q = (u.searchParams.get("q") || "").toLowerCase();
    if (q) {
      list = list.filter(a =>
        a.suburb.toLowerCase().includes(q) ||
        a.name.toLowerCase().includes(q) ||
        a.agency.toLowerCase().includes(q)
      );
    }

    const sort = $("#sortSel").value;
    const review = $("#reviewSel").value;
    const type = $("#typeSel").value;

    if (review) list = list.filter(a => a.reviews.last12 >= Number(review));
    if (type) list = list.filter(a => a.tags.some(t => t.toLowerCase().includes(type)));

    if (sort === "sales") list.sort((a, b) => b.stats.sold_suburb - a.stats.sold_suburb);
    else if (sort === "price") {
      const val = s => parseInt(String(s.stats.median_price).replace(/\D/g, "")) || 0;
      list.sort((a, b) => val(b) - val(a));
    } else if (sort === "days") list.sort((a, b) => a.stats.median_days - b.stats.median_days);

    if (currentMode === "Agency") {
      const seen = new Map();
      list = list.filter(a => { if (seen.has(a.agency)) return false; seen.set(a.agency, true); return true; });
    }

    renderAgents(list, currentMode === "Agency" ? "Agencies" : "Agents");
  }

  // Filter controls
  $("#agentBtn").addEventListener("click", () => { currentMode = "Agent"; renderFiltered(); });
  $("#agencyBtn").addEventListener("click", () => { currentMode = "Agency"; renderFiltered(); });
  ["sortSel", "reviewSel", "typeSel"].forEach(id =>
    document.getElementById(id).addEventListener("change", renderFiltered)
  );

  // INITIAL RENDER
  renderFiltered();
})();
  </script>
</body>

<footer class="site-footer">
  <div class="footer-inner">
    <div class="footer-cols">
      <div class="footer-col footer-brand">
        <div class="brand">
          <img src="/Assets/Logo.png" alt="MyHome logo" class="footer-logo" />
        </div>
      </div>

      <div class="footer-col">
        <h4 class="footer-title">Product</h4>
        <a href="#">How it works</a>
        <a href="#">Who we help</a>
        <a href="#">Features</a>
        <a href="#">Pricing</a>
      </div>

      <div class="footer-col">
        <h4 class="footer-title">Resources</h4>
        <a href="#">Get Help</a>
        <a href="#">Partnership</a>
        <a href="#">Blog</a>
        <a href="#">Legal</a>
      </div>

      <div class="footer-col">
        <h4 class="footer-title">About</h4>
        <a href="#">About</a>
        <a href="#">Sponsorship</a>
        <a href="#">Hardship</a>
        <a href="#">Contact</a>
      </div>

      <div class="footer-col footer-connect">
        <h4 class="footer-title">Connect with us</h4>
        <div class="footer-socials">
          <a href="#" aria-label="Facebook" class="icon">
            <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
              <image href="../Assets/facebook.png" width="18" height="18" />
            </svg>
          </a>
          <a href="#" aria-label="YouTube" class="icon">
            <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
              <image href="../Assets/youtube.png" width="18" height="18" />
            </svg>
          </a>
          <a href="#" aria-label="Twitter" class="icon">
            <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
              <image href="../Assets/twitter.png" width="18" height="18" />
            </svg>
          </a>
        </div>
      </div>
    </div>

    <hr class="footer-divider" />

    <div class="footer-bottom">
      <div>Copyright 2025 ¬∑ MyHome</div>
      <div class="footer-legal">
        <a href="#">Terms of Service</a>
        <a href="#">Privacy Policy</a>
      </div>
    </div>
  </div>
</footer>

</html>
